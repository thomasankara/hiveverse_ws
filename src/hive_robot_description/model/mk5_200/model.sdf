<?xml version="1.0" ?>
<sdf version="1.10">
  <model name="mk5_200">
    <static>false</static>



    <!-- ================== LINK PRINCIPAL (base_link) ================== -->
    <link name="base_link">
      <pose>0 0 0 0 0 0</pose>
      <inertial>
        <mass>54.0</mass>
        <inertia>
          <ixx>8.0</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>8.0</iyy><iyz>0</iyz>
          <izz>8.0</izz>
        </inertia>
      </inertial>

      <!-- Bloc bas -->
      <collision name="base_block_col">
        <pose>-0.025 0 0 0 0 0</pose>
        <geometry><box><size>0.2 0.4 0.15</size></box></geometry>
      </collision>
      <visual name="base_block_vis">
        <pose>-0.025 0 0 0 0 0</pose>
        <geometry><box><size>0.2 0.4 0.15</size></box></geometry>
        <material>
          <ambient>0.0 0.0 0.8 1</ambient>
          <diffuse>0.0 0.0 0.8 1</diffuse>
        </material>
      </visual>

      <!-- Grande plaque -->

      <visual name="base_plate_vis">
        <pose>-0.5 0 0.143 0 0 0</pose>
        <geometry><box><size>0.7 0.8 0.02</size></box></geometry>
        <material>
          <ambient>0.0 0.0 0.8 1</ambient>
          <diffuse>0.0 0.0 0.8 1</diffuse>
        </material>
      </visual>

      <!-- Box haute -->
      <collision name="base_box_col">
        <pose>-0.55 0 0.5 0 0 0</pose>
        <geometry><box><size>0.8 0.8 0.7</size></box></geometry>
      </collision>
      <visual name="base_box_vis">
        <pose>-0.55 0 0.5 0 0 0</pose>
        <geometry><box><size>0.8 0.8 0.7</size></box></geometry>
        <material>
          <ambient>0.5 0.5 0.5 1</ambient>
          <diffuse>0.5 0.5 0.5 1</diffuse>
        </material>
      </visual>

      <!-- Plaque avant inclinée -->
      <collision name="front_plate_col">
        <pose>-0.05 0 0.5 0 1.4 0</pose>
        <geometry><box><size>0.9 0.4 0.05</size></box></geometry>
      </collision>
      <visual name="front_plate_vis">
        <pose>-0.05 0 0.5 0 1.4 0</pose>
        <geometry><box><size>0.9 0.4 0.05</size></box></geometry>
        <material>
          <ambient>0.0 0.0 0.8 1</ambient>
          <diffuse>0.0 0.0 0.8 1</diffuse>
        </material>
      </visual>
    </link>
    <!-- ================== FIN base_link ================== -->

    <!-- ================== SENSOR LIDAR ================== -->





<!-- ================== AIRY FRONT SENSOR ================== -->
<!-- ================== AIRY FRONT SENSOR ================== -->
<!-- ================== AIRY FRONT SENSOR ================== -->

<joint name="airy_front_joint" type="fixed">
  <parent>base_link</parent>
  <child>airy_front</child>
  <pose>0.05 0.0 0.8 0 2.0 0</pose> <!-- Relative position of airy_front to base_link -->
</joint>

<link name="airy_front">
  
  <!-- Collision -->
  <collision name="airy_front_col">
    <pose relative_to="airy_front_joint">0.0 0.0 0 0 0 0</pose>
    <geometry>
      <cylinder>
        <radius>0.04</radius>
        <length>0.06</length>
      </cylinder>
    </geometry>
  </collision>
  
  <!-- Visual -->
  <visual name="airy_front_vis">
    <pose relative_to="airy_front_joint">0.0 0.0 0 0 0 0</pose>
    <geometry>
      <cylinder>
        <radius>0.04</radius>
        <length>0.06</length>
      </cylinder>
    </geometry>
    <material>
      <ambient>0.8 0.0 0.0 1</ambient>
      <diffuse>0.8 0.0 0.0 1</diffuse>
    </material>
  </visual>

  <!-- LiDAR Sensor -->
  <sensor name="gpu_lidar" type="gpu_lidar">
    <pose relative_to="airy_front_joint">0 0 0 0 0 0</pose>
    <topic>/lidar</topic>
    <update_rate>10</update_rate>
    <ray>
      <scan>
        <horizontal>
          <samples>640</samples>
          <resolution>1</resolution>
          <min_angle>-1.396263</min_angle>
          <max_angle>1.396263</max_angle>
        </horizontal>
        <vertical>
          <samples>1</samples>
          <resolution>0.01</resolution>
          <min_angle>0</min_angle>
          <max_angle>0</max_angle>
        </vertical>
      </scan>
      <range>
        <min>0.08</min>
        <max>10.0</max>
        <resolution>0.01</resolution>
      </range>
    </ray>
    <always_on>1</always_on>
    <visualize>true</visualize>
  </sensor>


</link>




           <plugin
            filename="gz-sim-sensors-system"
            name="gz::sim::systems::Sensors">
            <render_engine>ogre2</render_engine>
        </plugin>





    <!-- ================== FIN SENSOR LIDAR ================== -->

    <!-- ================== ROUES MOTRICES ================== -->
    <link name="left_wheel">
      <pose>0 0.317 0 0 0 0</pose>
      <inertial>
        <mass>8.0</mass>
        <inertia>
          <ixx>0.01</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.01</iyy><iyz>0</iyz>
          <izz>0.01</izz>
        </inertia>
      </inertial>
      <collision name="c">
        <pose>0 0 0 1.570796 0 0</pose>
        <geometry><cylinder><radius>0.162</radius><length>0.15</length></cylinder></geometry>
        <surface>
          <friction><ode><mu>1.0</mu><mu2>1.0</mu2></ode></friction>
        </surface>
      </collision>
      <visual name="v">
        <pose>0 0 0 1.570796 0 0</pose>
        <geometry><cylinder><radius>0.162</radius><length>0.15</length></cylinder></geometry>
        <material>
          <ambient>0.05 0.05 0.05 1</ambient>
          <diffuse>0.05 0.05 0.05 1</diffuse>
        </material>
      </visual>
    </link>
    <joint name="left_wheel_joint" type="revolute">
  <parent>base_link</parent>
  <child>left_wheel</child>
  <axis>
    <xyz>0 1 0</xyz>
    <!-- Limites de position très larges pour simuler rotation quasi infinie -->
    <limit>
      <lower>-1e16</lower>
      <upper>1e16</upper>
      <!-- Effort max : assez grand pour ne pas saturer, tu peux ajuster -->
      <effort>1e6</effort>
      <!-- Vitesse angulaire max (rad/s) : ici 50 rad/s (~477 rpm) -->
      <velocity>50.0</velocity>
    </limit>
    <!-- Optionnel: amortissement léger pour stabilité -->
    <dynamics>
      <damping>0.1</damping>
      <friction>0.0</friction>
    </dynamics>
  </axis>
</joint>


    <link name="right_wheel">
      <pose>0 -0.317 0 0 0 0</pose>
      <inertial>
        <mass>8.0</mass>
        <inertia>
          <ixx>0.01</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.01</iyy><iyz>0</iyz>
          <izz>0.01</izz>
        </inertia>
      </inertial>
      <collision name="c">
        <pose>0 0 0 1.570796 0 0</pose>
        <geometry><cylinder><radius>0.162</radius><length>0.15</length></cylinder></geometry>
        <surface>
          <friction><ode><mu>1.0</mu><mu2>1.0</mu2></ode></friction>
        </surface>
      </collision>
      <visual name="v">
        <pose>0 0 0 1.570796 0 0</pose>
        <geometry><cylinder><radius>0.162</radius><length>0.15</length></cylinder></geometry>
        <material>
          <ambient>0.05 0.05 0.05 1</ambient>
          <diffuse>0.05 0.05 0.05 1</diffuse>
        </material>
      </visual>
    </link>
<joint name="right_wheel_joint" type="revolute">
  <parent>base_link</parent>
  <child>right_wheel</child>
  <axis>
    <xyz>0 1 0</xyz>
    <!-- Limites de position très larges pour simuler rotation quasi infinie -->
    <limit>
      <lower>-1e16</lower>
      <upper>1e16</upper>
      <!-- Effort max : assez grand pour ne pas saturer, tu peux ajuster -->
      <effort>1e6</effort>
      <!-- Vitesse angulaire max (rad/s) : ici 50 rad/s (~477 rpm) -->
      <velocity>50.0</velocity>
    </limit>
    <!-- Optionnel: amortissement léger pour stabilité -->
    <dynamics>
      <damping>0.1</damping>
      <friction>0.0</friction>
    </dynamics>
  </axis>
</joint>


  <!-- ================== CASTERS ================== -->
<!-- LEFT CASTER PLATE -->
<link name="left_caster_plate">
  <pose>-0.747 0.26 0.115 0 0 0</pose>
  <inertial>
    <mass>0.5</mass>
    <inertia>
      <ixx>0.001</ixx><ixy>0</ixy><ixz>0</ixz>
      <iyy>0.001</iyy><iyz>0</iyz>
      <izz>0.001</izz>
    </inertia>
  </inertial>

  <visual name="v">
    <geometry><box><size>0.18 0.18 0.01</size></box></geometry>
    <material>
      <ambient>0.5 0.5 0.5 1</ambient>
      <diffuse>0.5 0.5 0.5 1</diffuse>
    </material>
  </visual>
</link>

<joint name="left_caster_plate_joint" type="revolute">
  <parent>base_link</parent>
  <child>left_caster_plate</child>
  <axis>
    <xyz>0 0 1</xyz>
    <limit><lower>-3.14159</lower><upper>3.14159</upper></limit>
    <dynamics><damping>0.2</damping></dynamics>
  </axis>
</joint>

<!-- LEFT CASTER WHEEL -->
<link name="left_caster_wheel">
  <pose>-0.807 0.26 -0.025 0 0 0</pose>
  <inertial>
    <mass>2.0</mass>
    <inertia>
      <ixx>0.05</ixx><ixy>0</ixy><ixz>0</ixz>
      <iyy>0.05</iyy><iyz>0</iyz>
      <izz>0.05</izz>
    </inertia>
  </inertial>
  <collision name="c">
    <pose>0 0 0 1.570796 0 0</pose>
    <geometry><cylinder><radius>0.13</radius><length>0.08</length></cylinder></geometry>
  </collision>
  <visual name="v">
    <pose>0 0 0 1.570796 0 0</pose>
    <geometry><cylinder><radius>0.13</radius><length>0.08</length></cylinder></geometry>
    <material>
      <ambient>0.05 0.05 0.05 1</ambient>
      <diffuse>0.05 0.05 0.05 1</diffuse>
    </material>
  </visual>
</link>

<joint name="left_caster_wheel_joint" type="revolute">
  <parent>left_caster_plate</parent>
  <child>left_caster_wheel</child>
  <axis>
    <xyz>0 1 0</xyz>
    <limit><lower>-100000</lower><upper>100000</upper></limit>
    <dynamics>
      <damping>0.05</damping> <!-- Friction added via damping -->
      <friction>0.01</friction> <!-- Adding a small friction to stabilize -->
    </dynamics>
  </axis>
</joint>

<!-- RIGHT CASTER PLATE -->
<link name="right_caster_plate">
  <pose>-0.747 -0.26 0.115 0 0 0</pose>
  <inertial>
    <mass>0.5</mass>
    <inertia>
      <ixx>0.001</ixx><ixy>0</ixy><ixz>0</ixz>
      <iyy>0.001</iyy><iyz>0</iyz>
      <izz>0.001</izz>
    </inertia>
  </inertial>

  <visual name="v">
    <geometry><box><size>0.18 0.18 0.01</size></box></geometry>
    <material>
      <ambient>0.5 0.5 0.5 1</ambient>
      <diffuse>0.5 0.5 0.5 1</diffuse>
    </material>
  </visual>
</link>

<joint name="right_caster_plate_joint" type="revolute">
  <parent>base_link</parent>
  <child>right_caster_plate</child>
  <axis>
    <xyz>0 0 1</xyz>
    <limit><lower>-3.14159</lower><upper>3.14159</upper></limit>
    <dynamics><damping>0.2</damping></dynamics>
  </axis>
</joint>

<!-- RIGHT CASTER WHEEL -->
<link name="right_caster_wheel">
  <pose>-0.807 -0.26 -0.025 0 0 0</pose>
  <inertial>
    <mass>2.0</mass>
    <inertia>
      <ixx>0.05</ixx><ixy>0</ixy><ixz>0</ixz>
      <iyy>0.05</iyy><iyz>0</iyz>
      <izz>0.05</izz>
    </inertia>
  </inertial>
  <collision name="c">
    <pose>0 0 0 1.570796 0 0</pose>
    <geometry><cylinder><radius>0.13</radius><length>0.08</length></cylinder></geometry>
  </collision>
  <visual name="v">
    <pose>0 0 0 1.570796 0 0</pose>
    <geometry><cylinder><radius>0.13</radius><length>0.08</length></cylinder></geometry>
    <material>
      <ambient>0.05 0.05 0.05 1</ambient>
      <diffuse>0.05 0.05 0.05 1</diffuse>
    </material>
  </visual>
</link>

<joint name="right_caster_wheel_joint" type="revolute">
  <parent>right_caster_plate</parent>
  <child>right_caster_wheel</child>
  <axis>
    <xyz>0 1 0</xyz>
    <limit><lower>-100000</lower><upper>100000</upper></limit>
    <dynamics>
      <damping>0.05</damping> <!-- Friction added via damping -->
      <friction>0.01</friction> <!-- Adding a small friction to stabilize -->
    </dynamics>
  </axis>
</joint>


    <!-- ================== PLUGIN DIFFDRIVE ================== -->
    <plugin name="gz::sim::systems::DiffDrive"
        filename="libgz-sim8-diff-drive-system.so">
  <left_joint>left_wheel_joint</left_joint>
  <right_joint>right_wheel_joint</right_joint>
  <wheel_separation>0.634</wheel_separation>
  <wheel_radius>0.162</wheel_radius>
  <topic>cmd_vel</topic>
  <odom_publish_frequency>30</odom_publish_frequency>
</plugin>


  </model>
</sdf>
